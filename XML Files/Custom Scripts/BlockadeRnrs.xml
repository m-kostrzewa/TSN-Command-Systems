<mission_data version="1.0" background_id_arme="77d373f9-ed2e-4726-a2b2-74bd775ac998" playerShipNames_arme="Artemis\Intrepid\Aegis\Horatio\Excalibur\Hera\Ceres\Diana">
  <start id_arme="77d373f9-ed2e-4726-a2b2-74bd775ac998">
    <!---->
  </start>
  <folder_arme name="Blockade runners" id_arme="78b82965-29e0-44a9-922a-6953969ca6d7" />

  <!-- Monkey patch custom keys bar -->
  <event name="Custom Keys Menu" id_arme="593899ce-83e0-41bf-abac-82ed9b15e00a" parent_id_arme="78b82965-29e0-44a9-922a-6953969ca6d7">
    <if_variable name="Ship Spawn Menu" comparator="EQUALS" value="7.0" />
    <if_timer_finished name="Ship Spawn Menu" />
    <set_gm_button text="Single Hegemony\Skaraan Blockade Runner" />
    <set_gm_button text="Single Hegemony\Torgoth Deminer" />
    <set_gm_button text="Single Hegemony\Torgoth WarpDisruptor" />
  </event>
  <event name="Clear" id_arme="149305b0-c5c0-4e70-b4a1-e8c794ad56b2" parent_id_arme="78b82965-29e0-44a9-922a-6953969ca6d7">
    <!-- FIXME: Race condition on variable CycleSpawnMenu, rarely works.  -->
    <if_variable name="CycleSpawnMenu" comparator="EQUALS" value="1.0" />
    <clear_gm_button text="Single Hegemony\Skaraan Blockade Runner" />
    <clear_gm_button text="Single Hegemony\Torgoth Deminer" />
    <clear_gm_button text="Single Hegemony\Torgoth WarpDisruptor" />
  </event>

  <event name="Skaraan Blockade Runner" id_arme="2a3fb12e-a77e-4aae-b1d1-f487a47d72e8" parent_id_arme="78b82965-29e0-44a9-922a-6953969ca6d7">
    <if_gm_button text="Single Hegemony\Skaraan Blockade Runner" />

    <create type="enemy" use_gm_position="" name="--" hullID="5000" sideValue="SideValue" fleetnumber="-1" />

    <set_object_property property="triggersMines" value="0" name="--" />
    <set_special name="--" ability="Warp" />

    <set_ship_text name="--" race="Skaraan" class="Blockade runner" desc="Skaraan blockade runner with experimental anti-mine stealth technology. Doesn't trigger mines." />

    <set_variable name="Fleet Settings" value="1.0" />
    <set_variable name="Auto AI Type" value="1.0" />
    <set_variable name="Random Direction" value="1.0" />
    <set_variable name="Name Assign" value="1.0" integer="yes" />
  </event>

  <event name="Torgoth Deminer" id_arme="6c8f603a-125e-4eb2-a668-67b909996a9b" parent_id_arme="78b82965-29e0-44a9-922a-6953969ca6d7">
    <if_gm_button text="Single Hegemony\Torgoth Deminer" />

    <create type="enemy" use_gm_position="" name="NewDeminer" hullID="4101" sideValue="SideValue" fleetnumber="Fleetnumber" />
    <!-- Ironically, make them trigger mines (and they're not anti torp), so players can use mines against them if they're lucky -->
    <!-- <set_object_property property="triggersMines" value="0" name="Deminer" /> -->

    <!-- Make them slower, so that it's easier to target them down, as they're high value targets -->
    <addto_object_property name="NewDeminer" property="topSpeed" value="0-0.6" />

    <add_ai type="SPCL_AI" name="NewDeminer" />
    <add_ai type="CHASE_PLAYER" name="NewDeminer" />
    <add_ai type="CHASE_STATION" value1="1000" name="NewDeminer" />
    <add_ai type="CHASE_AI_SHIP" value1="3000" value2="500" name="NewDeminer" />
    <add_ai type="CHASE_PLAYER" value1="3000" value2="500" name="NewDeminer" />
    <add_ai type="CHASE_ANGER" name="NewDeminer" />
    <add_ai type="LAUNCH_FIGHTERS" value1="5000" name="NewDeminer" />

    <set_ship_text name="NewDeminer" newname="Deminer" race="Torgoth" class="Deminer" desc="Torgoth Deminer support ship. Removes mines in vicinity." />

    <destroy_near type="mines" radius="1000" use_gm_position="" />
  
    <set_timer name="MineSweepTimer" seconds="1" />
    <set_variable name="MineSweepState" value="1.0" integer="yes" />
  </event>

  <event name="Sweep mines 1" id_arme="5df444e7-145e-411a-8668-4736fd310ad9" parent_id_arme="78b82965-29e0-44a9-922a-6953969ca6d7">
    <if_timer_finished name="MineSweepTimer" />
    <if_variable name="MineSweepState" comparator="EQUALS" value="1.0" />
    <if_exists name="Deminer" />

    <destroy_near type="mines" radius="1000" name="Deminer" />
    <set_ship_text name="Deminer" newname=" Deminer " />
  </event>

  <event name="Sweep mines 2" id_arme="dab5b09f-3d53-4385-97cc-816bef19a8c9" parent_id_arme="78b82965-29e0-44a9-922a-6953969ca6d7">
    <if_variable name="MineSweepState" comparator="EQUALS" value="1.0" />
    <if_not_exists name="Deminer" />

    <set_variable name="MineSweepState" value="2.0" integer="yes" />
  </event>

  <event name="Sweep mines 3" id_arme="eb775ab7-c8c7-4b75-a38f-7ca6b486f6ef" parent_id_arme="78b82965-29e0-44a9-922a-6953969ca6d7">
    <if_variable name="MineSweepState" comparator="EQUALS" value="2.0" />
    <if_exists name=" Deminer " />

    <set_ship_text name=" Deminer " newname="Deminer" />
  </event>

  <event name="Sweep mines 4" id_arme="a6c08d6b-41e2-421d-b15c-a93fa5032420" parent_id_arme="78b82965-29e0-44a9-922a-6953969ca6d7">
    <if_variable name="MineSweepState" comparator="EQUALS" value="2.0" />
    <if_not_exists name=" Deminer " />

    <set_timer name="MineSweepTimer" seconds="1" />
    <set_variable name="MineSweepState" value="1.0" integer="yes" />
  </event>




  <event name="Torgoth WarpDisruptor" id_arme="cf1752e7-2cca-4fa0-9421-608e4b3b91d3" parent_id_arme="78b82965-29e0-44a9-922a-6953969ca6d7">
    <if_gm_button text="Single Hegemony\Torgoth WarpDisruptor" />

    <create type="enemy" use_gm_position="" name="NewWarpDisruptor" hullID="4101" sideValue="SideValue" fleetnumber="Fleetnumber" />
    <addto_object_property name="NewWarpDisruptor" property="topSpeed" value="0-0.6" />

    <add_ai type="SPCL_AI" name="NewWarpDisruptor" />
    <add_ai type="CHASE_PLAYER" name="NewWarpDisruptor" />
    <add_ai type="CHASE_STATION" value1="1000" name="NewWarpDisruptor" />
    <add_ai type="CHASE_AI_SHIP" value1="3000" value2="500" name="NewWarpDisruptor" />
    <add_ai type="CHASE_PLAYER" value1="3000" value2="500" name="NewWarpDisruptor" />
    <add_ai type="CHASE_ANGER" name="NewWarpDisruptor" />
    <add_ai type="LAUNCH_FIGHTERS" value1="5000" name="NewWarpDisruptor" />

    <set_ship_text name="NewWarpDisruptor" newname="WarpDisruptor" race="Torgoth" class="WarpDisruptor" desc="Torgoth WarpDisruptor support ship. Removes mines in vicinity." />
  
    <set_timer name="WarpDisruptorTimer" seconds="1" />

    <!-- TODO: a timer for each player -->
    <set_timer name="WarpDisruptorCheckTimerPlayer0" seconds="1" />
  </event>

  <event name="Stabilize Spacetime - new loop" id_arme="c1e4da7e-186a-4504-add8-a7480493c3f5" parent_id_arme="78b82965-29e0-44a9-922a-6953969ca6d7">
    <if_timer_finished name="WarpDisruptorTimer" />

    <if_not_exists name=" WarpDisruptor " />
    <if_not_exists name="  WarpDisruptor  " />
    <set_ship_text name="WarpDisruptor" newname=" WarpDisruptor " />

    <set_timer name="WarpDisruptorTimer" seconds="1" />

    <set_variable name="WarpDisruptorCounterInternal" value="0.0" integer="yes" />

  </event>

  <event name="Stabilize Spacetime - promote single" id_arme="932cbbd0-0d46-45ed-9599-7148cab44fe1" parent_id_arme="78b82965-29e0-44a9-922a-6953969ca6d7">
    <if_timer_finished name="WarpDisruptorTimer" />
    <if_exists name=" WarpDisruptor " />

    <get_object_property property="positionX" name=" WarpDisruptor " variable="stabX" />
    <get_object_property property="positionZ" name=" WarpDisruptor " variable="stabZ" />

    <set_ship_text name=" WarpDisruptor " newname="  WarpDisruptor  " />
    <set_ship_text name="WarpDisruptor" newname=" WarpDisruptor " />

    <set_variable name="WarpDisruptorCounterInternal" value="WarpDisruptorCounterInternal+1" integer="yes'" />

    <set_timer name="WarpDisruptorTimer" seconds="1" />
  </event>

  <event name="Stabilize Spacetime - multiple reset" id_arme="13fd184d-663e-4e84-b22b-903067cdecbf" parent_id_arme="78b82965-29e0-44a9-922a-6953969ca6d7">
    <if_timer_finished name="WarpDisruptorTimer" />
    <if_not_exists name="WarpDisruptor" />
    <if_not_exists name=" WarpDisruptor " />
    <if_exists name="  WarpDisruptor  " />

    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />
    <set_ship_text name="  WarpDisruptor  " newname="WarpDisruptor" />

    <set_variable name="WarpDisruptorCounterActual" value="WarpDisruptorCounterInternal" integer="yes" />

    <set_timer name="WarpDisruptorTimer" seconds="1" />
  </event>

  <!-- TODO: such event for each player -->
  <event name="Stabilize Spacetime - Sabre" id_arme="05958847-8f1b-4bc0-b4c2-56798651f091" parent_id_arme="78b82965-29e0-44a9-922a-6953969ca6d7">
    <if_variable name="WarpDisruptorCounterActual" comparator="GREATER" value="0.0" />
    <if_timer_finished name="WarpDisruptorCheckTimerPlayer0" />
    <if_inside_sphere name="Artemis" centerX="stabX" centerY="0" centerZ="stabZ" radius="5000" />

    <set_variable name="randomWarpState" randomIntLow="0.0" randomIntHigh="4.0" />
    <set_object_property property="warpState" value="randomWarpState" name="Artemis" />

    <set_variable name="randomWarpEnergy" randomFloatLow="0.0" randomFloatHigh="1.0" />
    <set_object_property property="systemCurEnergyWarp" value="randomWarpEnergy" name="Artemis" />

    <!-- we multiply damage by number of disruptors to account for the fact that more disruptors = more "processing" time -->
    <addto_object_property value="WarpDisruptorCounterActual*0.05" property="systemCurHeatWarp" name="Artemis" />

    <!-- too spammy -->
    <!-- <warning_popup_message message="Warp drive flux field disrupted" consoles="MHWESCO" name="Artemis" /> -->

    <set_timer name="WarpDisruptorCheckTimerPlayer0" seconds="1" />
  </event>


</mission_data>